% Copyright © 2013 Alexey Mednikov, Valeriy Streltsov
% This work is free. You can redistribute it and/or modify it under the
% terms of the Do What The Fuck You Want To Public License, Version 2,
% as published by Sam Hocevar. See http://www.wtfpl.net/ for more details.

\ProvidesPackage{G2-105}[2003/07/07 v1.00 General reqs. GOST 2.105-95]
\NeedsTeXFormat{LaTeX2e}

\newcommand{\Gost@encoding}{}
\newcommand{\Gost@LineSpread}{1.3}
\DeclareOption{koi8-r}{\renewcommand{\Gost@encoding}{koi8-r}}
\DeclareOption{cp1251}{\renewcommand{\Gost@encoding}{cp1251}}
\DeclareOption{cp866}{\renewcommand{\Gost@encoding}{cp866}}
\DeclareOption{utf8}{\renewcommand{\Gost@encoding}{utf8}}

\ExecuteOptions{a4paper,14pt,final,utf8}
\ProcessOptions

% Импорт пакетов
\RequirePackage[\Gost@encoding]{inputenc}
\RequirePackage[normalem]{ulem}
\RequirePackage[english, russian]{babel}
\RequirePackage{mathtext}
\RequirePackage[T1]{fontenc}
\RequirePackage{flafter}
\RequirePackage{setspace}% почему-то приводит в порядок расстояние между строками в подписях оО

% Импорт заголовков для ПЗ и ТЗ
\input{PZ_title_include.tex}
\input{TZ_title_include.tex}

% Префикс, стоящий перед номерами рисунков и таблиц
\newcommand{\VSTUDocumentNumbersPrefix}{}
% Сеттеры
\newcommand{\VSTUSetDocumentNumbersPrefix}[1]{
  \renewcommand{\VSTUDocumentNumbersPrefix}{#1}
}

% Код документа (цифры) и его тип (выпускная работа бакалавра, магистерская диссертация и так далее)
\newcommand{\VSTUDocumentCodeSuffix}{UNKNOWN}
\newcommand{\VSTUDocumentCode}{UNKNOWN-\VSTUDocumentCodeSuffix}
\newcommand{\VSTUDocumentTypeDative}{выпускной работе бакалавра}   % в дательном падаже
\newcommand{\VSTUDocumentTypeGenitive}{выпускную работу бакалавра} % в родительном падеже
% Сеттеры
\newcommand{\VSTUSetDocumentCode}[1]{
  \renewcommand{\VSTUDocumentCode}{#1-\VSTUDocumentCodeSuffix}
}
\newcommand{\VSTUSetDocumentTypeDative}[1]{
  \renewcommand{\VSTUDocumentTypeDative}{#1}
}
\newcommand{\VSTUSetDocumentTypeGenitive}[1]{
  \renewcommand{\VSTUDocumentTypeGenitive}{#1}
}

% Номер приказа (месяц задается строкой!)
\newcommand{\VSTUOrderDate}{01}
\newcommand{\VSTUOrderMonth}{января}
\newcommand{\VSTUOrderYear}{2013}
\newcommand{\VSTUOrderNumber}{1000--ст}
% Сеттеры
\newcommand{\VSTUSetOrder}[4]{
  \renewcommand{\VSTUOrderYear}{#4}
  \renewcommand{\VSTUOrderMonth}{#3}
  \renewcommand{\VSTUOrderDate}{#2}
  \renewcommand{\VSTUOrderNumber}{#1}
}

% Получение строки приказа из параметров выше
\newcommand{\VSTUOrder}{\No~\VSTUOrderNumber\ от\ \VSTUOrderDate~\VSTUOrderMonth~\VSTUOrderYear~года}

% Факультет, кафедра и направление
\newcommand{\VSTUFaculty}{Электроники\ и\ вычислительной\ техники}
\newcommand{\VSTUDepartment}{Программное\ обеспечение\ автоматизированных\ систем}
\newcommand{\VSTUDepartmentCode}{10.19}
\newcommand{\VSTUDirection}{230100\ Информатика\ и\ вычислительная\ техника}
% Сеттеры
\newcommand{\VSTUSetFaculty}[1]{
  \renewcommand{\VSTUFaculty}{#1}
}
\newcommand{\VSTUSetDepartment}[1]{
  \renewcommand{\VSTUDepartment}{#1}
}
\newcommand{\VSTUSetDepartmentCode}[1]{
  \renewcommand{\VSTUDepartmentCode}{#1}
}
\newcommand{\VSTUSetDirection}[1]{
  \renewcommand{\VSTUDirection}{#1}
}

% ФИО заведующего кафедрой, степень\должность
\newcommand{\VSTUHeadOfDepartmentFullName}{Фамилия\ Имя\ Отчество}
\newcommand{\VSTUHeadOfDepartmentName}{И.\ О.\ Фамилия}
\newcommand{\VSTUHeadOfDepartmentDegree}{кто-то,\ какая-то\ каф.}
\newcommand{\VSTUHeadOfDepartmentPost}{зав.\ каф.\ XXX}
% Сеттеры
\newcommand{\VSTUSetHeadOfDepartment}[4]{
  \renewcommand{\VSTUHeadOfDepartmentFullName}{#4}
  \renewcommand{\VSTUHeadOfDepartmentName}{#3}
  \renewcommand{\VSTUHeadOfDepartmentDegree}{#2}
  \renewcommand{\VSTUHeadOfDepartmentPost}{#1}
}

% ФИО руководителя, степень\должность
\newcommand{\VSTUDirectorFullName}{Фамилия\ Имя\ Отчество}
\newcommand{\VSTUDirectorName}{И.\ О.\ Фамилия}
\newcommand{\VSTUDirectorDegree}{кто-то,\ какая-то\ каф.}
% Сеттеры
\newcommand{\VSTUSetDirector}[3]{
  \renewcommand{\VSTUDirectorFullName}{#3}
  \renewcommand{\VSTUDirectorName}{#2}
  \renewcommand{\VSTUDirectorDegree}{#1}
}

% ФИО нормоконтролера, степень\должность
\newcommand{\VSTUStandardsAdviserFullName}{Фамилия\ Имя\ Отчество}
\newcommand{\VSTUStandardsAdviserName}{И.\ О.\ Фамилия}
\newcommand{\VSTUStandardsAdviserDegree}{кто-то,\ какая-то\ каф.}
% Сеттеры
\newcommand{\VSTUSetStandardsAdviser}[3]{
  \renewcommand{\VSTUStandardsAdviserFullName}{#3}
  \renewcommand{\VSTUStandardsAdviserName}{#2}
  \renewcommand{\VSTUStandardsAdviserDegree}{#1}
}

% ФИО студента, группа
\newcommand{\VSTUStudentFullName}{Фамилия\ Имя\ Отчество}
\newcommand{\VSTUStudentName}{И.\ О.\ Фамилия}
\newcommand{\VSTUStudentGroup}{ГРП--000}
% Сеттеры
\newcommand{\VSTUSetStudent}[3]{
  \renewcommand{\VSTUStudentFullName}{#3}
  \renewcommand{\VSTUStudentName}{#2}
  \renewcommand{\VSTUStudentGroup}{#1}
}

% Название дипломной работы на русском и английском языках
\newcommand{\VSTUTitle}{Title}
\newcommand{\VSTUTitleUL}{\uline{Title}}
\newcommand{\VSTUTitleEng}{TitleEng}
\newcommand{\VSTUTitleULEng}{\uline{TitleEng}}
% Сеттеры
\newcommand{\VSTUSetTitle}[1]{
    \renewcommand{\VSTUTitle}{#1}
    \renewcommand{\VSTUTitleUL}{\uline{#1}}
}
\newcommand{\VSTUSetTitleEng}[1]{
    \renewcommand{\VSTUTitleEng}{#1}
    \renewcommand{\VSTUTitleULEng}{\uline{#1}}
}

% Стиль страницы
\RequirePackage{fancyhdr}
\fancypagestyle{plain} {
  \setlength\headheight{25pt}
  \fancyhf{}
  \fancyhf[HCO,HCE]{\mdseries{\VSTUDocumentCode{}\vspace{2mm}}}
  \fancyhf[FCO,FCE]{\thepage}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}
\pagestyle{plain}
\pagenumbering{arabic}
\raggedbottom
\onecolumn

% 3.6 Абзацный отступ - 15..17 мм
\setlength\parindent{15mm}

% Всякие разные длины
\newcommand{\@pnumwidth}{1.55em}
\renewcommand{\baselinestretch}{}
\@lowpenalty 51
\@medpenalty 151
\@highpenalty 301
\setlength\columnsep{10\p@}
\setlength\columnseprule{0\p@}
\setlength\lineskip{1\p@}
\setlength\normallineskip{1\p@}
\setlength\parskip{0\p@ \@plus \p@}
\setlength\leftmargini{2.5em}
\setlength\leftmarginii{2.2em}
\setlength\labelsep{.5em}
\setlength\labelwidth{\leftmargini}\addtolength\labelwidth{-\labelsep}
\setlength\arraycolsep{5\p@}
\setlength\tabcolsep{6\p@}
\setlength\arrayrulewidth{.4\p@}
\setlength\doublerulesep{2\p@}
\setlength\tabbingsep{\labelsep}
\setlength\fboxsep{3\p@}
\setlength\fboxrule{.4\p@}

% Счетчики общего числа страниц, таблиц, рисунков и источников
\newcounter{totalpages}     \setcounter{totalpages}{0}
\newcounter{totalfigures}   \setcounter{totalfigures}{0}
\newcounter{totaltables}    \setcounter{totaltables}{0}
\newcounter{totalequations} \setcounter{totalequations}{0}
\newcounter{totalbibs}      \setcounter{totalbibs}{0}
\newcounter{totalappendices}\setcounter{totalappendices}{0}

% На последней странице ставятся метки с номерами
%  - последней страницы
%  - числа таблиц, имеющих caption
%  - числа рисунков, имеющих caption
\def\totalobjects@putlabel{
  \addtocounter{totalpages}    {\c@page}
  \addtocounter{totalfigures}  {\c@figure}
  \addtocounter{totaltables}   {\c@table}
  \addtocounter{totalequations}{\c@equation}

  \addtocounter{totalfigures}   {-1}
  \addtocounter{totaltables}    {-1}
  \addtocounter{totalequations} {-1}
  \addtocounter{totalbibs}      {-1}
  \addtocounter{totalappendices}{-1}

  \refstepcounter{totalpages}     \label{reftotalpages}
  \refstepcounter{totalfigures}   \label{reftotalfigures}
  \refstepcounter{totaltables}    \label{reftotaltables}
  \refstepcounter{totalequations} \label{reftotalequations}
  \refstepcounter{totalbibs}      \label{reftotalbibs}
  \refstepcounter{totalappendices}\label{reftotalappendices}
}
\AtEndDocument{\totalobjects@putlabel}

% Команды отображение общего числа ...
\newcommand{\totalpages}     {\pageref{reftotalpages}}
\newcommand{\totalfigures}   {\ref{reftotalfigures}}
\newcommand{\totaltables}    {\ref{reftotaltables}}
\newcommand{\totalequations} {\ref{reftotalequations}}
\newcommand{\totalbibs}      {\ref{reftotalbibs}}
\newcommand{\totalappendices}{\ref{reftotalappendices}}

% 4.1.1 - 4.1.6 Деление документа

% Команды для подстройки вида заголовков
% Расстояние между заголовком и текстом
\newlength\GostAfterTitleSkip    \setlength\GostAfterTitleSkip    {15mm}
\newlength\GostBetweenTitleSkip  \setlength\GostBetweenTitleSkip  {8mm}
\newlength\GostBeforTitleSkip    \setlength\GostBeforTitleSkip    {15mm}
\newlength\GostBeforNoTitleSkip  \setlength\GostBeforNoTitleSkip  {1.0ex}
\newlength\GostHTitleSpace       \setlength\GostHTitleSpace       {2mm}
\newlength\GostTitleIndent       \setlength\GostTitleIndent       {\parindent}
\newlength\Gost@ChapterIndent    \setlength\Gost@ChapterIndent    {\GostTitleIndent}
\newlength\Gost@MainChapterIndent\setlength\Gost@MainChapterIndent{\parindent}
\newlength{\Gost@TitleDropSkip}
\setlength\Gost@TitleDropSkip{\GostBetweenTitleSkip}
\addtolength\Gost@TitleDropSkip{-\GostAfterTitleSkip}

% Стиль всех заголовков
\newcommand{\GostTitleStyle}{\normalfont\mdseries\parshape 1 0cm \textwidth}
\newcommand{\Gost@MainChapterStyle}{}
\newcommand{\Gost@ChapterStyle}{\Gost@MainChapterStyle}

% Раздел
\newcounter{chapter}
\renewcommand{\thechapter}{\@arabic\c@chapter}
\newcommand{\chapter}{%
  \clearpage%
  \@startsection{chapter}{0}%
  {\Gost@ChapterIndent}{0mm}{\GostAfterTitleSkip}%
  {\GostTitleStyle\normalfont\Gost@ChapterStyle}%
}
\newcommand*{\chaptermark}[1]{}
\newcommand{\apart}[2]{\chapter {#2\label{#1}}}
\newcommand{\cpart}[2]{\chapter*{#2\label{#1}}}

% Подраздел
\newcounter{section}[chapter]
\renewcommand{\thesection}{\thechapter.\@arabic\c@section}
\newcommand{\section}{%
  \@startsection{section}{1}%
  {\GostTitleIndent}{\GostBeforTitleSkip}{\GostAfterTitleSkip}%
  {\GostTitleStyle}%
}
\newcommand{\asubpart}[2]{\section{#2\label{#1}}}

% Пункт
\newcounter{subsection}[section]
\renewcommand{\thesubsection}{\thesection.\@arabic\c@subsection}

\newcommand{\subsection}{%
  \@startsection{subsection}{2}%
  {\GostTitleIndent}{\GostBeforTitleSkip}{\GostAfterTitleSkip}%
  {\GostTitleStyle}%
}
\newcommand{\apara}[2]{\subsection{#2\label{#1}}}

% Подпункт
\newcounter{subsubsection}[subsection]
\renewcommand{\thesubsubsection}{\thesubsection.\@arabic\c@subsubsection}

\newcommand{\subsubsection}{%
  \@startsection{subsubsection}{4}%
  {\GostTitleIndent}{\GostBeforTitleSkip}{\GostAfterTitleSkip}%
  {\GostTitleStyle}%
}
\newcommand{\asubpara}[2]{\subsubsection{#2\label{#1}}}

% Команда ttl должна вставлятся между двумя заголовками
\newlength{\NirTitleDropSkip}
\newcommand{\ttl}{\vspace{\Gost@TitleDropSkip}}

% Нумеруются все заголовки
\setcounter{secnumdepth}{3}
% В оглавлении - тоже могут быть все.
\setcounter{tocdepth}{4} %% virens: обычно только первый подраздел
% Перенос в словах-с-дефисом
\lccode`\-=`\-
\defaulthyphenchar=127

% Перечисления

\newlength{\GostItemGap}
\newlength{\GostItemIndent}
\newcommand{\Gost@List}{%
  \setlength{\itemsep}{0mm}%                 пробел между последовательными элементами
  \setlength{\topsep}{0mm}%                  отступ от текста до перечня
  \setlength{\partopsep}{0mm}%               дополнительный отступ,  если начали абзац
  \setlength{\parsep}{0mm}%                  расстояние между абзацами внутри пункта
  \setlength{\leftmargin}{0mm}%              левый отступ до текста
  \setlength{\itemindent}{\GostItemIndent}%  дополнительный левый отступ первой строчки
  \setlength{\labelsep}{\GostItemGap}%       от метки до текста
}

\newcommand{\Gost@ListII}{%
  \setlength{\itemsep}{0mm}%                 пробел между последовательными элементами
  \setlength{\topsep}{0mm}%                  отступ от текста до перечня
  \setlength{\partopsep}{0mm}%               дополнительный отступ,  если начали абзац
  \setlength{\parsep}{0mm}%                  расстояние между абзацами внутри пункта
  \setlength{\leftmargin}{\GostItemIndent}%  левый отступ до текста
  \setlength{\itemindent}{\GostItemIndent}%  дополнительный левый отступ первой строчки
  \setlength{\labelsep}{\GostItemGap}%       от метки до текста
}

\renewcommand{\@listI} {\Gost@List}
\renewcommand{\@listii}{\Gost@ListII}
\setlength\GostItemGap{2mm} % небольшие отступы для пунктов перечисления
\setlength\leftmarginii{\parindent}
\setlength\GostItemIndent{\parindent}
%\addtolength\GostItemIndent{\GostItemGap}

% Ненумерованные перечисления
\newcommand{\labelitemi}{--}

% Нумерованные перечисления
\renewcommand{\theenumi}{\asbuk{enumi}}
\renewcommand{\theenumii}{\arabic{enumii}}
\newcommand{\labelenumi}{\theenumi)}
\newcommand{\labelenumii}{\theenumii)}
\renewcommand{\p@enumii}{\theenumi}

% Ссылка на нумерованное перечисление
\newcommand{\pref}[2]{%
 перечисление~\ref{#2})~\ref{#1}}

% Перечисление типа abbreviation - для списка сокращения
\newenvironment{abbreviation}{%
  \list{}{%
    \labelwidth\z@ \itemindent-\leftmargin \leftmargin 25mm%
    \let\makelabel\abbreviationlabel%
  }%
}{%
  \endlist%
}
\newcommand*{\abbreviationlabel}[1]{\hspace\labelsep\normalfont #1~---}

% Иллюстрации

\newcommand{\@makecaption}{}
\RequirePackage[center]{caption2}

\def\fps@figure{bph}
\def\ftype@figure{1}
\def\ext@figure{lof}
\def\fnum@figure{\figurename~\thefigure}

\newcounter{figure}
\newenvironment{figure} {\@float   {figure}}{\end@float}
\newenvironment{figure*}{\@dblfloat{figure}}{\end@dblfloat}
\renewcommand{\captionlabeldelim}{ ---}

% Подписи и номера рисунков
\addto\captionsrussian{\def\figurename{{Рисунок}}}
\renewcommand{\thefigure}{\VSTUDocumentNumbersPrefix\arabic{figure}}

% Таблицы

\RequirePackage{longtable}

\def\ftype@table{1}
\def\ext@table{lof}
\def\fnum@table{\tablename~\thetable}

% Нумерация таблиц
\renewcommand{\thetable}{\VSTUDocumentNumbersPrefix\arabic{table}}

% Для выравнивания таблиц
\LTpre = 10pt
\LTpost = 24pt
\LTleft = \z@
\LTright = \fill
\def\LT@makecaption#1#2#3{%
  \LT@mcol\LT@cols l{\hbox to\z@{\parbox[t]\LTcapwidth{%
      \sbox\@tempboxa{#1{#2\captionlabeldelim{} }#3}%
          {\box\@tempboxa\hfil}%
          \endgraf}%
    \hss}}}

% Формулы

\RequirePackage{amssymb} % для русских "меньше или равно" "больше или равно"
\RequirePackage{icomma}
\input{leqno.clo}

% Нумерация формул
\renewcommand{\theequation}{\VSTUDocumentNumbersPrefix\arabic{equation}}

% Приложения

\newcounter{appendix}
\gdef\theappendix{\@Asbuk\c@appendix}

% Общая команда для приложений
\newcommand{\appendixcommon}[1]{
  \addtocounter{appendix}{1}
  \addtocounter{totalappendices}{1}

  % Грязный хак нумерации рисунков\таблиц\формул внутри приложений.
  % Сначала добавляем figure к totalfigures, а затем сбрасываем figure в 0.
  % Аналогично и для table.
  \addtocounter{totalfigures}{\c@figure}%
  \addtocounter{totaltables}{\c@table}%
  \addtocounter{totalequations}{\c@equation}%
  \setcounter{figure}{0}%
  \setcounter{table}{0}%
  \setcounter{equation}{0}%

  % Внешний вид номеров рисунков: сначала номер приложения,
  % за ним номер рисунка\таблицы внутри приложения.
  \renewcommand{\thefigure}{\VSTUDocumentNumbersPrefix\theappendix.\arabic{figure}}%
  \renewcommand{\thetable}{\VSTUDocumentNumbersPrefix\theappendix.\arabic{table}}%
  \renewcommand{\theequation}{\VSTUDocumentNumbersPrefix\theappendix.\arabic{equation}}

  \begin{center}%
  \appendixname~\theappendix~---~{#1}%
  \end{center}%
  \addcontentsline{toc}{chapter}{\appendixname~\theappendix~---~{#1}}%
}

% Обычное приложение
\newcommand{\appendix}[1]{
  \clearpage
  \appendixcommon{#1}
}

% Приложение в виде отдельного документа
\newcommand{\appendixdocument}[1]{
  \clearpage
  \leavevmode
  \vfill
  \appendixcommon{#1}
  \vfill
}

% Всякие оглавления
\newcommand{\tableofcontents}{
  \renewcommand{\contentsname}{Содержание}
  \chapter*{\contentsname}\@starttoc{toc}
}
\newcommand{\listoffigures}{
  \chapter*{\listfigurename}\@starttoc{lof}
}
\newcommand{\listoftables}{
  \chapter*{\listtablename}\@starttoc{lot}
}

\def\l@chapter#1#2{\pagebreak[3]
   \@tempdima 1.1em       % width of box holding chapter number
   \begingroup
     \parindent \z@ \rightskip \@pnumwidth
     \parfillskip -\@pnumwidth
     \leavevmode          % TeX command to enter horizontal mode.
     #1\hfil \hbox to\@pnumwidth{\hss #2}\par%% <= \medskip inserted
   \endgroup}
\def\l@section#1#2{\pagebreak[3]
   \@tempdima 2.1em       % width of box holding chapter number
   \begingroup
     \parindent \z@ \rightskip \@pnumwidth
     \parfillskip -\@pnumwidth
     \leavevmode          % TeX command to enter horizontal mode.
     #1\hfil \hbox to\@pnumwidth{\hss #2}\par%% <= \medskip inserted
   \endgroup}
\def\l@subsection#1#2{\pagebreak[3]
   \@tempdima 3.1em       % width of box holding chapter number
   \begingroup
     \parindent \z@ \rightskip \@pnumwidth
     \parfillskip -\@pnumwidth
     \leavevmode          % TeX command to enter horizontal mode.
     #1\hfil \hbox to\@pnumwidth{\hss #2}\par%% <= \medskip inserted
   \endgroup}
\def\l@subsubsection#1#2{\pagebreak[3]
   \@tempdima 4.1em       % width of box holding chapter number
   \begingroup
     \parindent \z@ \rightskip \@pnumwidth
     \parfillskip -\@pnumwidth
     \leavevmode          % TeX command to enter horizontal mode.
     #1\hfil \hbox to\@pnumwidth{\hss #2}\par%% <= \medskip inserted
   \endgroup}
\newcommand*{\l@figure}{\@dottedtocline{1}{1.5em}{2.3em}}
\newcommand*{\l@table}{\@dottedtocline{1}{1.5em}{2.3em}}
\newcommand{\@tocrmarg}{2.55em}  % отступ правого края оглавления перенесенных строк
\newcommand{\@dotsep}{1000}      % между точками в оглавлении в em
\linespread{\Gost@LineSpread}  % полуторный межстрочный интервал

\AtBeginDocument{%
  \makeatletter%
    %\setlength\Gost@EqRemLen{\textwidth}%
    %\addtolength\Gost@EqRemLen{-10mm}%
    %\settowidth\Gost@@EqRemLen{где}%
    %\addtolength\Gost@EqRemLen{-\Gost@@EqRemLen}%
  \makeatother%
}

% Библиография
\newdimen\bibindent
\newenvironment{thebibliography}[1]{
\renewcommand{\bibname}{Список использованных источников}
  \chapter*{\bibname}\ttl\addcontentsline{toc}{chapter}{\bibname}%
  \list{\@biblabel{\@arabic\c@enumiv}}%
       {\settowidth\labelwidth{\@biblabel{#1}}%
         \leftmargin\labelwidth
         \advance\leftmargin\labelsep
         \@openbib@code
         \usecounter{enumiv}%
         \let\p@enumiv\@empty
         \renewcommand{\theenumiv}{\@arabic\c@enumiv}}%
  \sloppy\clubpenalty4000\widowpenalty4000%
  \sfcode`\.\@m
}{
  \setcounter{totalbibs}{\c@enumiv}%
  \def\@noitemerr
  {\@latex@warning{Empty `thebibliography' environment}}%
  \endlist
}
\renewcommand{\@biblabel}{}%
\setlength\bibindent{1.5em}

% Индекс
\newenvironment{theindex}{
                \columnseprule \z@
                \columnsep 35\p@
                \twocolumn[\@makeschapterhead{\indexname}]%
                \thispagestyle{plain}\parindent\z@
                \parskip\z@ \@plus .3\p@\relax
                \let\item\@idxitem}
               {\onecolumn}
\newcommand{\newblock}{\hskip .11em\@plus.33em\@minus.07em}
\let\@openbib@code\@empty
\newcommand{\@idxitem}{\par\hangindent 40\p@}
\newcommand{\subitem}{\@idxitem \hspace*{20\p@}}
\newcommand{\subsubitem}{\@idxitem \hspace*{30\p@}}
\newcommand{\indexspace}{\par \vskip 10\p@ \@plus5\p@ \@minus3\p@\relax}

% Штуки для русского языка и переносов
\righthyphenmin = 2
\unitlength = 1mm
\clubpenalty = 10000
\widowpenalty = 10000

\@beginparpenalty -\@lowpenalty
\@endparpenalty -\@lowpenalty
\@itempenalty -\@lowpenalty
\skip\@mpfootins = \skip\footins
